<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <title>ÎÇòÌä∏Îûë Ïó¨Ìñâ Ïä§ÏºÄÏ§Ñ</title>
  
  <style>
    :root{
      --accent:#7b1f3a;
      --muted:#f6f3f4;
      --success:#28a745;
      --danger:#dc3545;
      --warning:#ffc107;
      --info:#17a2b8;
      --light:#f8f9fa;
      --dark:#343a40;
    }
    
    * {
      box-sizing: border-box;
    }
    
    body{
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0;
      padding: 10px;
      color: #333;
      min-height: 100vh;
    }
    
    .container {
      max-width: 100%;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, var(--accent), #9c1e4a);
      color: white;
      padding: 20px;
      text-align: center;
    }
    
    .header h1 {
      margin: 0;
      font-size: 24px;
      font-weight: 700;
    }
    
    .header .subtitle {
      margin: 5px 0 0 0;
      font-size: 14px;
      opacity: 0.9;
    }
    
    .toolbar {
      padding: 15px 20px;
      background: var(--light);
      border-bottom: 1px solid #e9ecef;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }
    
    .flight-note {
      background: linear-gradient(135deg, #fff3f3, #ffe8e8);
      border-left: 4px solid var(--accent);
      padding: 12px;
      border-radius: 10px;
      font-size: 13px;
      color: #666;
      flex: 1;
      min-width: 200px;
    }
    
    .controls {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .share-section {
      background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
      padding: 15px;
      border-radius: 15px;
      margin: 15px 0;
      text-align: center;
    }
    
    .share-link {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 25px;
      padding: 10px 15px;
      margin: 10px 0;
      font-family: monospace;
      font-size: 14px;
      word-break: break-all;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .share-link:hover {
      border-color: var(--accent);
      background: #f8f9fa;
    }
    
    .copy-btn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
      cursor: pointer;
      margin-left: 10px;
    }
    
    button {
      background: var(--accent);
      color: white;
      border: none;
      padding: 12px 16px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(123, 31, 58, 0.3);
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(123, 31, 58, 0.4);
    }
    
    button.secondary {
      background: #6c757d;
      box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
    }
    
    button.success {
      background: var(--success);
      box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
    }
    
    button.danger {
      background: var(--danger);
      box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
    }
    
    .schedule-container {
      padding: 20px;
    }
    
    .schedule-card {
      background: white;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.08);
      margin-bottom: 15px;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .schedule-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .schedule-header {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      padding: 15px 20px;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .date-info {
      display: flex;
      flex-direction: column;
    }
    
    .date {
      font-size: 18px;
      font-weight: 700;
      color: var(--accent);
      margin: 0;
    }
    
    .day {
      font-size: 14px;
      color: #666;
      margin: 2px 0 0 0;
    }
    
    .time {
      font-size: 16px;
      font-weight: 600;
      color: #333;
    }
    
    .schedule-content {
      padding: 20px;
    }
    
    .activity {
      font-size: 16px;
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
    }
    
    .location {
      font-size: 14px;
      color: #666;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
    }
    
    .location:before {
      content: "üìç";
      margin-right: 5px;
    }
    
    .transport {
      font-size: 14px;
      color: #666;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
    }
    
    .transport:before {
      content: "üöó";
      margin-right: 5px;
    }
    
    .confirmation {
      font-size: 14px;
      color: #666;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
    }
    
    .confirmation:before {
      content: "‚úÖ";
      margin-right: 5px;
    }
    
    .notes {
      font-size: 14px;
      color: #666;
      font-style: italic;
    }
    
    .card-actions {
      display: flex;
      gap: 8px;
      margin-top: 15px;
    }
    
    .card-actions button {
      padding: 8px 12px;
      font-size: 12px;
      border-radius: 20px;
    }
    
    .add-schedule {
      background: linear-gradient(135deg, var(--success), #20c997);
      color: white;
      border: none;
      padding: 15px 25px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      width: 100%;
      margin: 20px 0;
      box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
      transition: all 0.3s ease;
    }
    
    .add-schedule:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
    }
    
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #666;
    }
    
    .empty-state h3 {
      margin: 0 0 10px 0;
      color: #999;
    }
    
    .fab {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--accent);
      color: white;
      border: none;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(123, 31, 58, 0.4);
      transition: all 0.3s ease;
      z-index: 1000;
    }
    
    .fab:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 25px rgba(123, 31, 58, 0.6);
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 2000;
    }
    
    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: 20px;
      padding: 30px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .modal-header h3 {
      margin: 0;
      color: var(--accent);
    }
    
    .close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #999;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
    }
    
    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 12px;
      border: 2px solid #e9ecef;
      border-radius: 10px;
      font-size: 16px;
      transition: border-color 0.3s ease;
    }
    
    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--accent);
    }
    
    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }
    
    .form-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }
    
    .stats {
      display: flex;
      justify-content: space-around;
      background: var(--light);
      padding: 15px;
      border-radius: 15px;
      margin-bottom: 20px;
    }
    
    .stat {
      text-align: center;
    }
    
    .stat-number {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent);
    }
    
    .stat-label {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
    }
    
    .qr-code {
      text-align: center;
      margin: 20px 0;
    }
    
    .qr-code img {
      max-width: 200px;
      border-radius: 10px;
    }
    
    @media (max-width: 768px) {
      .container {
        margin: 0;
        border-radius: 0;
        min-height: 100vh;
      }
      
      .header {
        padding: 15px;
      }
      
      .header h1 {
        font-size: 20px;
      }
      
      .toolbar {
        padding: 10px 15px;
        flex-direction: column;
        align-items: stretch;
      }
      
      .flight-note {
        margin-bottom: 10px;
      }
      
      .controls {
        justify-content: center;
      }
      
      .schedule-container {
        padding: 15px;
      }
      
      .schedule-header {
        padding: 12px 15px;
      }
      
      .schedule-content {
        padding: 15px;
      }
      
      .modal-content {
        width: 95%;
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üèñÔ∏è ÎÇòÌä∏Îûë Ïó¨Ìñâ Ïä§ÏºÄÏ§Ñ</h1>
      <div class="subtitle">2025ÎÖÑ 10Ïõî 10Ïùº ~ 15Ïùº</div>
    </div>

    <div class="toolbar">
      <div class="flight-note">
        ‚úàÔ∏è Ï†úÏ£ºÌï≠Í≥µ (Jeju Air) ‚Äî Ìï≠Í≥µÌé∏ Ï†ïÎ≥¥Îäî Í∞Å ÏùºÏ†ïÏùò ÌôïÏù∏ÎûÄÏóê ÏûÖÎ†•ÌïòÏÑ∏Ïöî
      </div>
      <div class="controls">
        <button onclick="downloadCSV()">üìä CSV Îã§Ïö¥Î°úÎìú</button>
        <button class="secondary" onclick="window.print()">üñ®Ô∏è Ïù∏ÏáÑ</button>
        <button class="success" onclick="shareSchedule()">üîó Í≥µÏú†ÌïòÍ∏∞</button>
      </div>
    </div>

    <div class="schedule-container">
      <div class="stats">
        <div class="stat">
          <div class="stat-number" id="totalDays">6</div>
          <div class="stat-label">Ïó¨Ìñâ ÏùºÏàò</div>
        </div>
        <div class="stat">
          <div class="stat-number" id="totalActivities">6</div>
          <div class="stat-label">Í≥ÑÌöçÎêú ÌôúÎèô</div>
        </div>
        <div class="stat">
          <div class="stat-number" id="completedActivities">0</div>
          <div class="stat-label">ÏôÑÎ£åÎêú ÌôúÎèô</div>
        </div>
      </div>

      <div id="scheduleList">
        <!-- ÏùºÏ†ï Ïπ¥ÎìúÎì§Ïù¥ Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
      </div>

      <div class="share-section" id="shareSection" style="display: none;">
        <h4>üîó Ïä§ÏºÄÏ§Ñ Í≥µÏú†ÌïòÍ∏∞</h4>
        <p>Ïù¥ ÎßÅÌÅ¨Î•º Îã§Î•∏ Í∏∞Í∏∞ÎÇò ÏÇ¨ÎûåÍ≥º Í≥µÏú†ÌïòÎ©¥ Í∞ôÏùÄ Ïä§ÏºÄÏ§ÑÏùÑ Î≥º Ïàò ÏûàÏäµÎãàÎã§!</p>
        <div class="share-link" id="shareLink" onclick="copyShareLink()">
          ÎßÅÌÅ¨Î•º ÏÉùÏÑ±ÌïòÎäî Ï§ë...
        </div>
        <button class="copy-btn" onclick="copyShareLink()">üìã Î≥µÏÇ¨</button>
        <button class="secondary" onclick="closeShareSection()">Îã´Í∏∞</button>
        
        <div class="qr-code">
          <div id="qrcode"></div>
        </div>
      </div>

      <button class="add-schedule" onclick="openAddModal()">
        ‚ûï ÏÉà ÏùºÏ†ï Ï∂îÍ∞ÄÌïòÍ∏∞
      </button>
    </div>
  </div>

  <!-- ÌîåÎ°úÌåÖ Ïï°ÏÖò Î≤ÑÌäº -->
  <button class="fab" onclick="openAddModal()" title="ÏùºÏ†ï Ï∂îÍ∞Ä">
    +
  </button>

  <!-- ÏùºÏ†ï Ï∂îÍ∞Ä/Ìé∏Ïßë Î™®Îã¨ -->
  <div id="scheduleModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalTitle">ÏÉà ÏùºÏ†ï Ï∂îÍ∞Ä</h3>
        <button class="close" onclick="closeModal()">&times;</button>
      </div>
      <form id="scheduleForm">
        <div class="form-group">
          <label for="scheduleDate">ÎÇ†Ïßú</label>
          <input type="date" id="scheduleDate" required>
        </div>
        <div class="form-group">
          <label for="scheduleTime">ÏãúÍ∞Ñ</label>
          <input type="time" id="scheduleTime">
        </div>
        <div class="form-group">
          <label for="scheduleActivity">ÌôúÎèô/ÏùºÏ†ï</label>
          <input type="text" id="scheduleActivity" placeholder="Ïòà: ÏãúÎÇ¥Í¥ÄÍ¥ë, Ìï¥Î≥Ä Ìú¥Ïãù" required>
        </div>
        <div class="form-group">
          <label for="scheduleLocation">Ïû•ÏÜå</label>
          <input type="text" id="scheduleLocation" placeholder="Ïòà: ÎÇòÌä∏Îûë ÎπÑÏπò, Ìè¨ÎÇòÍ∞ÄÎ•¥ ÌÉë">
        </div>
        <div class="form-group">
          <label for="scheduleTransport">Ïù¥ÎèôÏàòÎã®</label>
          <select id="scheduleTransport">
            <option value="">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
            <option value="ÎèÑÎ≥¥">üö∂ ÎèÑÎ≥¥</option>
            <option value="ÌÉùÏãú">üöï ÌÉùÏãú</option>
            <option value="Î≤ÑÏä§">üöå Î≤ÑÏä§</option>
            <option value="Î≥¥Ìä∏">‚õµ Î≥¥Ìä∏</option>
            <option value="Ìà¨Ïñ¥Î≤ÑÏä§">üöå Ìà¨Ïñ¥Î≤ÑÏä§</option>
            <option value="Î¶¨Ï°∞Ìä∏ ÏÖîÌãÄ">üöå Î¶¨Ï°∞Ìä∏ ÏÖîÌãÄ</option>
            <option value="Í≥µÌï≠Î≤ÑÏä§">üöå Í≥µÌï≠Î≤ÑÏä§</option>
            <option value="Ï†úÏ£ºÌï≠Í≥µ">‚úàÔ∏è Ï†úÏ£ºÌï≠Í≥µ</option>
          </select>
        </div>
        <div class="form-group">
          <label for="scheduleConfirmation">ÌôïÏù∏/ÏòàÏïΩÎ≤àÌò∏</label>
          <input type="text" id="scheduleConfirmation" placeholder="Ìï≠Í≥µÌé∏, Ìò∏ÌÖî ÏòàÏïΩÎ≤àÌò∏ Îì±">
        </div>
        <div class="form-group">
          <label for="scheduleNotes">ÎπÑÍ≥†</label>
          <textarea id="scheduleNotes" placeholder="Ï∂îÍ∞Ä Î©îÎ™®ÎÇò ÌäπÏù¥ÏÇ¨Ìï≠"></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="secondary" onclick="closeModal()">Ï∑®ÏÜå</button>
          <button type="submit" class="success">Ï†ÄÏû•</button>
        </div>
      </form>
    </div>
  </div>

  <!-- QR ÏΩîÎìú ÎùºÏù¥Î∏åÎü¨Î¶¨ -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

  <script>
    // ÏùºÏ†ï Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•ÏÜå
    let schedules = [];
    let editingIndex = -1;
    let shareId = null;

    // Ï¥àÍ∏∞ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
    document.addEventListener('DOMContentLoaded', function() {
      initializeApp();
    });

    // Ïï± Ï¥àÍ∏∞Ìôî
    function initializeApp() {
      // URLÏóêÏÑú Í≥µÏú† ID ÌôïÏù∏
      const urlParams = new URLSearchParams(window.location.search);
      const id = urlParams.get('id');
      
      if (id) {
        shareId = id;
        loadSharedSchedule(id);
      } else {
        loadSchedules();
      }
      
      renderSchedules();
      updateStats();
    }

    // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú ÏùºÏ†ï Î°úÎìú
    function loadSchedules() {
      const saved = localStorage.getItem('nhatrangSchedules');
      if (saved) {
        schedules = JSON.parse(saved);
      } else {
        // Í∏∞Î≥∏ ÏùºÏ†ï Îç∞Ïù¥ÌÑ∞
        schedules = [
          {
            id: 1,
            date: '2025-10-10',
            time: '14:00',
            activity: 'Ïù∏Ï≤ú/ÍπÄÌè¨ ‚Üí ÎÇòÌä∏Îûë(ÎèÑÏ∞©) / Ï≤¥ÌÅ¨Ïù∏',
            location: 'Í≥µÌï≠, Ìò∏ÌÖî',
            transport: 'Ï†úÏ£ºÌï≠Í≥µ / Í≥µÌï≠Î≤ÑÏä§/ÌÉùÏãú',
            confirmation: '',
            notes: 'Ï∂úÎ∞ú - Ìï≠Í≥µÌé∏ ÏãúÍ∞Ñ ÏûÖÎ†•'
          },
          {
            id: 2,
            date: '2025-10-11',
            time: '09:00',
            activity: 'ÏãúÎÇ¥Í¥ÄÍ¥ë / Ìï¥Î≥Ä / Ïï°Ìã∞ÎπÑÌã∞',
            location: 'ÎÇòÌä∏Îûë ÎπÑÏπò, Ìè¨ÎÇòÍ∞ÄÎ•¥ ÌÉë Îì±',
            transport: 'ÎèÑÎ≥¥/ÌÉùÏãú/Ìà¨Ïñ¥Î≤ÑÏä§',
            confirmation: '',
            notes: ''
          },
          {
            id: 3,
            date: '2025-10-12',
            time: '08:00',
            activity: 'Ïä§ÎÖ∏ÌÅ¥ÎßÅ/Îã§Ïù¥Îπô/Ìò∏ÌïëÌà¨Ïñ¥',
            location: 'Ïù∏Í∑º ÏÑ¨/Î¶¨Ï°∞Ìä∏',
            transport: 'Î≥¥Ìä∏',
            confirmation: '',
            notes: ''
          },
          {
            id: 4,
            date: '2025-10-13',
            time: '10:00',
            activity: 'Î¨∏Ìôî/ÏãúÏû• Î∞©Î¨∏, Ïπ¥Ìéò',
            location: 'Îã¥ÏãúÏû• Îì±',
            transport: 'ÌÉùÏãú/ÎèÑÎ≥¥',
            confirmation: '',
            notes: ''
          },
          {
            id: 5,
            date: '2025-10-14',
            time: '11:00',
            activity: 'Î¶¨Ï°∞Ìä∏ Ìú¥Ïãù / Ïä§Ìåå',
            location: 'Î¶¨Ï°∞Ìä∏',
            transport: 'Î¶¨Ï°∞Ìä∏ ÏÖîÌãÄ/ÎèÑÎ≥¥',
            confirmation: '',
            notes: ''
          },
          {
            id: 6,
            date: '2025-10-15',
            time: '16:00',
            activity: 'Ï≤¥ÌÅ¨ÏïÑÏõÉ ‚Üí Í≥µÌï≠ Ïù¥Îèô ‚Üí Í∑ÄÍµ≠',
            location: 'Ìò∏ÌÖî, Í≥µÌï≠',
            transport: 'ÌÉùÏãú/Í≥µÌï≠Î≤ÑÏä§ / Ï†úÏ£ºÌï≠Í≥µ',
            confirmation: '',
            notes: 'Ï∂úÎ∞ú - Ìï≠Í≥µÌé∏ ÏãúÍ∞Ñ ÏûÖÎ†•'
          }
        ];
        saveSchedules();
      }
    }

    // Í≥µÏú†Îêú Ïä§ÏºÄÏ§Ñ Î°úÎìú
    function loadSharedSchedule(id) {
      const sharedData = localStorage.getItem(`shared_schedule_${id}`);
      if (sharedData) {
        schedules = JSON.parse(sharedData);
      } else {
        // Í≥µÏú†Îêú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ Í∏∞Î≥∏ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
        loadSchedules();
      }
    }

    // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóê ÏùºÏ†ï Ï†ÄÏû•
    function saveSchedules() {
      localStorage.setItem('nhatrangSchedules', JSON.stringify(schedules));
      
      // Í≥µÏú† IDÍ∞Ä ÏûàÏúºÎ©¥ Í≥µÏú† Îç∞Ïù¥ÌÑ∞ÎèÑ ÏóÖÎç∞Ïù¥Ìä∏
      if (shareId) {
        localStorage.setItem(`shared_schedule_${shareId}`, JSON.stringify(schedules));
      }
    }

    // ÏùºÏ†ï Î™©Î°ù Î†åÎçîÎßÅ
    function renderSchedules() {
      const scheduleList = document.getElementById('scheduleList');
      
      if (schedules.length === 0) {
        scheduleList.innerHTML = `
          <div class="empty-state">
            <h3>ÏïÑÏßÅ ÏùºÏ†ïÏù¥ ÏóÜÏäµÎãàÎã§</h3>
            <p>‚ûï Î≤ÑÌäºÏùÑ ÎàåÎü¨ Ï≤´ Î≤àÏß∏ ÏùºÏ†ïÏùÑ Ï∂îÍ∞ÄÌï¥Î≥¥ÏÑ∏Ïöî!</p>
          </div>
        `;
        return;
      }

      // ÎÇ†ÏßúÏàúÏúºÎ°ú Ï†ïÎ†¨
      const sortedSchedules = [...schedules].sort((a, b) => new Date(a.date) - new Date(b.date));

      scheduleList.innerHTML = sortedSchedules.map((schedule, index) => {
        const date = new Date(schedule.date);
        const dayNames = ['ÏùºÏöîÏùº', 'ÏõîÏöîÏùº', 'ÌôîÏöîÏùº', 'ÏàòÏöîÏùº', 'Î™©ÏöîÏùº', 'Í∏àÏöîÏùº', 'ÌÜ†ÏöîÏùº'];
        const dayName = dayNames[date.getDay()];
        
        return `
          <div class="schedule-card" data-id="${schedule.id}">
            <div class="schedule-header">
              <div class="date-info">
                <div class="date">${schedule.date}</div>
                <div class="day">${dayName}</div>
              </div>
              <div class="time">${schedule.time || 'ÏãúÍ∞Ñ ÎØ∏Ï†ï'}</div>
            </div>
            <div class="schedule-content">
              <div class="activity">${schedule.activity}</div>
              ${schedule.location ? `<div class="location">${schedule.location}</div>` : ''}
              ${schedule.transport ? `<div class="transport">${schedule.transport}</div>` : ''}
              ${schedule.confirmation ? `<div class="confirmation">${schedule.confirmation}</div>` : ''}
              ${schedule.notes ? `<div class="notes">${schedule.notes}</div>` : ''}
              <div class="card-actions">
                <button class="success" onclick="editSchedule(${schedule.id})">‚úèÔ∏è Ìé∏Ïßë</button>
                <button class="danger" onclick="deleteSchedule(${schedule.id})">üóëÔ∏è ÏÇ≠Ï†ú</button>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // ÌÜµÍ≥Ñ ÏóÖÎç∞Ïù¥Ìä∏
    function updateStats() {
      document.getElementById('totalActivities').textContent = schedules.length;
      document.getElementById('completedActivities').textContent = schedules.filter(s => s.confirmation).length;
    }

    // Î™®Îã¨ Ïó¥Í∏∞
    function openAddModal() {
      editingIndex = -1;
      document.getElementById('modalTitle').textContent = 'ÏÉà ÏùºÏ†ï Ï∂îÍ∞Ä';
      document.getElementById('scheduleForm').reset();
      document.getElementById('scheduleModal').style.display = 'block';
      document.body.style.overflow = 'hidden';
    }

    // ÏùºÏ†ï Ìé∏Ïßë Î™®Îã¨ Ïó¥Í∏∞
    function editSchedule(id) {
      const schedule = schedules.find(s => s.id === id);
      if (!schedule) return;

      editingIndex = schedules.indexOf(schedule);
      document.getElementById('modalTitle').textContent = 'ÏùºÏ†ï Ìé∏Ïßë';
      
      // ÌèºÏóê Îç∞Ïù¥ÌÑ∞ Ï±ÑÏö∞Í∏∞
      document.getElementById('scheduleDate').value = schedule.date;
      document.getElementById('scheduleTime').value = schedule.time || '';
      document.getElementById('scheduleActivity').value = schedule.activity;
      document.getElementById('scheduleLocation').value = schedule.location || '';
      document.getElementById('scheduleTransport').value = schedule.transport || '';
      document.getElementById('scheduleConfirmation').value = schedule.confirmation || '';
      document.getElementById('scheduleNotes').value = schedule.notes || '';
      
      document.getElementById('scheduleModal').style.display = 'block';
      document.body.style.overflow = 'hidden';
    }

    // Î™®Îã¨ Îã´Í∏∞
    function closeModal() {
      document.getElementById('scheduleModal').style.display = 'none';
      document.body.style.overflow = 'auto';
    }

    // ÏùºÏ†ï ÏÇ≠Ï†ú
    function deleteSchedule(id) {
      if (confirm('Ïù¥ ÏùºÏ†ïÏùÑ ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
        schedules = schedules.filter(s => s.id !== id);
        saveSchedules();
        renderSchedules();
        updateStats();
      }
    }

    // Ìèº Ï†úÏ∂ú Ï≤òÎ¶¨
    document.getElementById('scheduleForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = {
        id: editingIndex === -1 ? Date.now() : schedules[editingIndex].id,
        date: document.getElementById('scheduleDate').value,
        time: document.getElementById('scheduleTime').value,
        activity: document.getElementById('scheduleActivity').value,
        location: document.getElementById('scheduleLocation').value,
        transport: document.getElementById('scheduleTransport').value,
        confirmation: document.getElementById('scheduleConfirmation').value,
        notes: document.getElementById('scheduleNotes').value
      };

      if (editingIndex === -1) {
        schedules.push(formData);
      } else {
        schedules[editingIndex] = formData;
      }

      saveSchedules();
      renderSchedules();
      updateStats();
      closeModal();
    });

    // CSV Îã§Ïö¥Î°úÎìú
    function downloadCSV() {
      const headers = ['ÎÇ†Ïßú', 'ÏöîÏùº', 'ÏãúÍ∞Ñ', 'ÌôúÎèô', 'Ïû•ÏÜå', 'Ïù¥ÎèôÏàòÎã®', 'ÌôïÏù∏', 'ÎπÑÍ≥†'];
      const rows = [headers.join(',')];

      const sortedSchedules = [...schedules].sort((a, b) => new Date(a.date) - new Date(b.date));
      
      sortedSchedules.forEach(schedule => {
        const date = new Date(schedule.date);
        const dayNames = ['ÏùºÏöîÏùº', 'ÏõîÏöîÏùº', 'ÌôîÏöîÏùº', 'ÏàòÏöîÏùº', 'Î™©ÏöîÏùº', 'Í∏àÏöîÏùº', 'ÌÜ†ÏöîÏùº'];
        const dayName = dayNames[date.getDay()];
        
        const row = [
          schedule.date,
          dayName,
          schedule.time || '',
          `"${schedule.activity}"`,
          `"${schedule.location || ''}"`,
          `"${schedule.transport || ''}"`,
          `"${schedule.confirmation || ''}"`,
          `"${schedule.notes || ''}"`
        ];
        rows.push(row.join(','));
      });

      const csv = rows.join('\n');
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `ÎÇòÌä∏Îûë_Ïó¨Ìñâ_Ïä§ÏºÄÏ§Ñ_${new Date().toISOString().split('T')[0]}.csv`;
      link.click();
      URL.revokeObjectURL(url);
    }

    // Í≥µÏú† Í∏∞Îä•
    function shareSchedule() {
      if (!shareId) {
        // ÏÉà Í≥µÏú† ID ÏÉùÏÑ±
        shareId = 'share_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        
        // Í≥µÏú† Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
        localStorage.setItem(`shared_schedule_${shareId}`, JSON.stringify(schedules));
        
        // URL ÏóÖÎç∞Ïù¥Ìä∏
        const newUrl = `${window.location.origin}${window.location.pathname}?id=${shareId}`;
        window.history.replaceState({}, '', newUrl);
      }
      
      const shareUrl = `${window.location.origin}${window.location.pathname}?id=${shareId}`;
      document.getElementById('shareLink').textContent = shareUrl;
      document.getElementById('shareSection').style.display = 'block';
      
      // QR ÏΩîÎìú ÏÉùÏÑ±
      generateQRCode(shareUrl);
    }

    // QR ÏΩîÎìú ÏÉùÏÑ±
    function generateQRCode(url) {
      const qrContainer = document.getElementById('qrcode');
      qrContainer.innerHTML = '';
      
      QRCode.toCanvas(qrContainer, url, {
        width: 200,
        height: 200,
        color: {
          dark: '#7b1f3a',
          light: '#ffffff'
        }
      }, function (error) {
        if (error) {
          console.error('QR ÏΩîÎìú ÏÉùÏÑ± Ïã§Ìå®:', error);
          qrContainer.innerHTML = '<p>QR ÏΩîÎìú ÏÉùÏÑ± Ïã§Ìå®</p>';
        }
      });
    }

    // Í≥µÏú† ÎßÅÌÅ¨ Î≥µÏÇ¨
    async function copyShareLink() {
      const shareUrl = document.getElementById('shareLink').textContent;
      
      try {
        if (navigator.clipboard) {
          await navigator.clipboard.writeText(shareUrl);
          showNotification('ÎßÅÌÅ¨Í∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§! üìã');
        } else {
          // Íµ¨Ìòï Î∏åÎùºÏö∞Ï†Ä ÏßÄÏõê
          const textArea = document.createElement('textarea');
          textArea.value = shareUrl;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          showNotification('ÎßÅÌÅ¨Í∞Ä Î≥µÏÇ¨ÎêòÏóàÏäµÎãàÎã§! üìã');
        }
      } catch (error) {
        console.error('Î≥µÏÇ¨ Ïã§Ìå®:', error);
        showNotification('Î≥µÏÇ¨Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§. ÎßÅÌÅ¨Î•º ÏßÅÏ†ë Î≥µÏÇ¨Ìï¥Ï£ºÏÑ∏Ïöî.', 'error');
      }
    }

    // Í≥µÏú† ÏÑπÏÖò Îã´Í∏∞
    function closeShareSection() {
      document.getElementById('shareSection').style.display = 'none';
    }

    // ÏïåÎ¶º ÌëúÏãú
    function showNotification(message, type = 'success') {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'error' ? '#dc3545' : '#28a745'};
        color: white;
        padding: 12px 20px;
        border-radius: 25px;
        font-size: 14px;
        font-weight: 600;
        z-index: 10000;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        animation: slideIn 0.3s ease;
      `;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 3000);
    }

    // CSS Ïï†ÎãàÎ©îÏù¥ÏÖò Ï∂îÍ∞Ä
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `;
    document.head.appendChild(style);

    // Î™®Îã¨ Ïô∏Î∂Ä ÌÅ¥Î¶≠Ïãú Îã´Í∏∞
    document.getElementById('scheduleModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeModal();
      }
    });

    // ESC ÌÇ§Î°ú Î™®Îã¨ Îã´Í∏∞
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeModal();
      }
    });

    // ÌÑ∞Ïπò Ï†úÏä§Ï≤ò ÏßÄÏõê (Î™®Î∞îÏùº)
    let startX = 0;
    let startY = 0;

    document.addEventListener('touchstart', function(e) {
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
    });

    document.addEventListener('touchend', function(e) {
      if (!startX || !startY) return;

      const endX = e.changedTouches[0].clientX;
      const endY = e.changedTouches[0].clientY;
      const diffX = startX - endX;
      const diffY = startY - endY;

      // Ï¢åÏö∞ Ïä§ÏôÄÏù¥ÌîÑ Í∞êÏßÄ
      if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
        if (diffX > 0) {
          // ÏôºÏ™ΩÏúºÎ°ú Ïä§ÏôÄÏù¥ÌîÑ - Îã§Ïùå ÏùºÏ†ïÏúºÎ°ú
          console.log('ÏôºÏ™Ω Ïä§ÏôÄÏù¥ÌîÑ');
        } else {
          // Ïò§Î•∏Ï™ΩÏúºÎ°ú Ïä§ÏôÄÏù¥ÌîÑ - Ïù¥Ï†Ñ ÏùºÏ†ïÏúºÎ°ú
          console.log('Ïò§Î•∏Ï™Ω Ïä§ÏôÄÏù¥ÌîÑ');
        }
      }

      startX = 0;
      startY = 0;
    });
  </script>
</body>
</html>
