<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <title>ë‚˜íŠ¸ë‘ ì—¬í–‰ ìŠ¤ì¼€ì¤„</title>
  
  <style>
    :root{
      --accent:#7b1f3a;
      --muted:#f6f3f4;
      --success:#28a745;
      --danger:#dc3545;
      --warning:#ffc107;
      --info:#17a2b8;
      --light:#f8f9fa;
      --dark:#343a40;
    }
    
    * {
      box-sizing: border-box;
    }
    
    body{
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0;
      padding: 10px;
      color: #333;
      min-height: 100vh;
    }
    
    .container {
      max-width: 100%;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, var(--accent), #9c1e4a);
      color: white;
      padding: 20px;
      text-align: center;
    }
    
    .header h1 {
      margin: 0;
      font-size: 24px;
      font-weight: 700;
    }
    
    .header .subtitle {
      margin: 5px 0 0 0;
      font-size: 14px;
      opacity: 0.9;
    }
    
    .toolbar {
      padding: 15px 20px;
      background: var(--light);
      border-bottom: 1px solid #e9ecef;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }
    
    .flight-note {
      background: linear-gradient(135deg, #fff3f3, #ffe8e8);
      border-left: 4px solid var(--accent);
      padding: 12px;
      border-radius: 10px;
      font-size: 13px;
      color: #666;
      flex: 1;
      min-width: 200px;
    }
    
    .controls {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .share-section {
      background: linear-gradient(135deg, #e3f2fd, #f3e5f5);
      padding: 15px;
      border-radius: 15px;
      margin: 15px 0;
      text-align: center;
    }
    
    .share-link {
      background: white;
      border: 2px solid #e0e0e0;
      border-radius: 25px;
      padding: 10px 15px;
      margin: 10px 0;
      font-family: monospace;
      font-size: 14px;
      word-break: break-all;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .share-link:hover {
      border-color: var(--accent);
      background: #f8f9fa;
    }
    
    .copy-btn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 12px;
      cursor: pointer;
      margin-left: 10px;
    }
    
    button {
      background: var(--accent);
      color: white;
      border: none;
      padding: 12px 16px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(123, 31, 58, 0.3);
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(123, 31, 58, 0.4);
    }
    
    button.secondary {
      background: #6c757d;
      box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
    }
    
    button.success {
      background: var(--success);
      box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
    }
    
    button.danger {
      background: var(--danger);
      box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
    }
    
    .schedule-container {
      padding: 20px;
    }
    
    .schedule-card {
      background: white;
      border-radius: 15px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.08);
      margin-bottom: 15px;
      overflow: hidden;
      transition: all 0.3s ease;
    }
    
    .schedule-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    }
    
    .schedule-header {
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      padding: 15px 20px;
      border-bottom: 1px solid #dee2e6;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .date-info {
      display: flex;
      flex-direction: column;
    }
    
    .date {
      font-size: 18px;
      font-weight: 700;
      color: var(--accent);
      margin: 0;
    }
    
    .day {
      font-size: 14px;
      color: #666;
      margin: 2px 0 0 0;
    }
    
    .time {
      font-size: 16px;
      font-weight: 600;
      color: #333;
    }
    
    .schedule-content {
      padding: 20px;
    }
    
    .activity {
      font-size: 16px;
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
    }
    
    .location {
      font-size: 14px;
      color: #666;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
    }
    
    .location:before {
      content: "ğŸ“";
      margin-right: 5px;
    }
    
    .transport {
      font-size: 14px;
      color: #666;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
    }
    
    .transport:before {
      content: "ğŸš—";
      margin-right: 5px;
    }
    
    .confirmation {
      font-size: 14px;
      color: #666;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
    }
    
    .confirmation:before {
      content: "âœ…";
      margin-right: 5px;
    }
    
    .notes {
      font-size: 14px;
      color: #666;
      font-style: italic;
    }
    
    .card-actions {
      display: flex;
      gap: 8px;
      margin-top: 15px;
    }
    
    .card-actions button {
      padding: 8px 12px;
      font-size: 12px;
      border-radius: 20px;
    }
    
    .add-schedule {
      background: linear-gradient(135deg, var(--success), #20c997);
      color: white;
      border: none;
      padding: 15px 25px;
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      width: 100%;
      margin: 20px 0;
      box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
      transition: all 0.3s ease;
    }
    
    .add-schedule:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
    }
    
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: #666;
    }
    
    .empty-state h3 {
      margin: 0 0 10px 0;
      color: #999;
    }
    
    .fab {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--accent);
      color: white;
      border: none;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(123, 31, 58, 0.4);
      transition: all 0.3s ease;
      z-index: 1000;
    }
    
    .fab:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 25px rgba(123, 31, 58, 0.6);
    }
    
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 2000;
    }
    
    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      border-radius: 20px;
      padding: 30px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .modal-header h3 {
      margin: 0;
      color: var(--accent);
    }
    
    .close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #999;
    }
    
    .form-group {
      margin-bottom: 20px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
    }
    
    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 12px;
      border: 2px solid #e9ecef;
      border-radius: 10px;
      font-size: 16px;
      transition: border-color 0.3s ease;
    }
    
    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--accent);
    }
    
    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }
    
    .form-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }
    
    .stats {
      display: flex;
      justify-content: space-around;
      background: var(--light);
      padding: 15px;
      border-radius: 15px;
      margin-bottom: 20px;
    }
    
    .stat {
      text-align: center;
    }
    
    .stat-number {
      font-size: 24px;
      font-weight: 700;
      color: var(--accent);
    }
    
    .stat-label {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
    }
    
    .qr-code {
      text-align: center;
      margin: 20px 0;
    }
    
    .qr-code img {
      max-width: 200px;
      border-radius: 10px;
    }
    
    @media (max-width: 768px) {
      .container {
        margin: 0;
        border-radius: 0;
        min-height: 100vh;
      }
      
      .header {
        padding: 15px;
      }
      
      .header h1 {
        font-size: 20px;
      }
      
      .toolbar {
        padding: 10px 15px;
        flex-direction: column;
        align-items: stretch;
      }
      
      .flight-note {
        margin-bottom: 10px;
      }
      
      .controls {
        justify-content: center;
      }
      
      .schedule-container {
        padding: 15px;
      }
      
      .schedule-header {
        padding: 12px 15px;
      }
      
      .schedule-content {
        padding: 15px;
      }
      
      .modal-content {
        width: 95%;
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ–ï¸ ë‚˜íŠ¸ë‘ ì—¬í–‰ ìŠ¤ì¼€ì¤„</h1>
      <div class="subtitle">2025ë…„ 10ì›” 10ì¼ ~ 15ì¼</div>
    </div>

    <div class="toolbar">
      <div class="flight-note">
        âœˆï¸ ì œì£¼í•­ê³µ (Jeju Air) â€” í•­ê³µí¸ ì •ë³´ëŠ” ê° ì¼ì •ì˜ í™•ì¸ë€ì— ì…ë ¥í•˜ì„¸ìš”
      </div>
      <div class="controls">
        <button onclick="downloadCSV()">ğŸ“Š CSV ë‹¤ìš´ë¡œë“œ</button>
        <button class="secondary" onclick="window.print()">ğŸ–¨ï¸ ì¸ì‡„</button>
        <button class="success" onclick="shareSchedule()">ğŸ”— ê³µìœ í•˜ê¸°</button>
      </div>
    </div>

    <div class="schedule-container">
      <div class="stats">
        <div class="stat">
          <div class="stat-number" id="totalDays">6</div>
          <div class="stat-label">ì—¬í–‰ ì¼ìˆ˜</div>
        </div>
        <div class="stat">
          <div class="stat-number" id="totalActivities">6</div>
          <div class="stat-label">ê³„íšëœ í™œë™</div>
        </div>
        <div class="stat">
          <div class="stat-number" id="completedActivities">0</div>
          <div class="stat-label">ì™„ë£Œëœ í™œë™</div>
        </div>
      </div>

      <div id="scheduleList">
        <!-- ì¼ì • ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤ -->
      </div>

      <div class="share-section" id="shareSection" style="display: none;">
        <h4>ğŸ”— ìŠ¤ì¼€ì¤„ ê³µìœ í•˜ê¸°</h4>
        <p>ì´ ë§í¬ë¥¼ ë‹¤ë¥¸ ê¸°ê¸°ë‚˜ ì‚¬ëŒê³¼ ê³µìœ í•˜ë©´ ê°™ì€ ìŠ¤ì¼€ì¤„ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤!</p>
        <div class="share-link" id="shareLink" onclick="copyShareLink()">
          ë§í¬ë¥¼ ìƒì„±í•˜ëŠ” ì¤‘...
        </div>
        <button class="copy-btn" onclick="copyShareLink()">ğŸ“‹ ë³µì‚¬</button>
        <button class="secondary" onclick="closeShareSection()">ë‹«ê¸°</button>
        
        <div class="qr-code">
          <div id="qrcode"></div>
        </div>
      </div>

      <button class="add-schedule" onclick="openAddModal()">
        â• ìƒˆ ì¼ì • ì¶”ê°€í•˜ê¸°
      </button>
    </div>
  </div>

  <!-- í”Œë¡œíŒ… ì•¡ì…˜ ë²„íŠ¼ -->
  <button class="fab" onclick="openAddModal()" title="ì¼ì • ì¶”ê°€">
    +
  </button>

  <!-- ì¼ì • ì¶”ê°€/í¸ì§‘ ëª¨ë‹¬ -->
  <div id="scheduleModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalTitle">ìƒˆ ì¼ì • ì¶”ê°€</h3>
        <button class="close" onclick="closeModal()">&times;</button>
      </div>
      <form id="scheduleForm">
        <div class="form-group">
          <label for="scheduleDate">ë‚ ì§œ</label>
          <input type="date" id="scheduleDate" required>
        </div>
        <div class="form-group">
          <label for="scheduleTime">ì‹œê°„</label>
          <input type="time" id="scheduleTime">
        </div>
        <div class="form-group">
          <label for="scheduleActivity">í™œë™/ì¼ì •</label>
          <input type="text" id="scheduleActivity" placeholder="ì˜ˆ: ì‹œë‚´ê´€ê´‘, í•´ë³€ íœ´ì‹" required>
        </div>
        <div class="form-group">
          <label for="scheduleLocation">ì¥ì†Œ</label>
          <input type="text" id="scheduleLocation" placeholder="ì˜ˆ: ë‚˜íŠ¸ë‘ ë¹„ì¹˜, í¬ë‚˜ê°€ë¥´ íƒ‘">
        </div>
        <div class="form-group">
          <label for="scheduleTransport">ì´ë™ìˆ˜ë‹¨</label>
          <select id="scheduleTransport">
            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
            <option value="ë„ë³´">ğŸš¶ ë„ë³´</option>
            <option value="íƒì‹œ">ğŸš• íƒì‹œ</option>
            <option value="ë²„ìŠ¤">ğŸšŒ ë²„ìŠ¤</option>
            <option value="ë³´íŠ¸">â›µ ë³´íŠ¸</option>
            <option value="íˆ¬ì–´ë²„ìŠ¤">ğŸšŒ íˆ¬ì–´ë²„ìŠ¤</option>
            <option value="ë¦¬ì¡°íŠ¸ ì…”í‹€">ğŸšŒ ë¦¬ì¡°íŠ¸ ì…”í‹€</option>
            <option value="ê³µí•­ë²„ìŠ¤">ğŸšŒ ê³µí•­ë²„ìŠ¤</option>
            <option value="ì œì£¼í•­ê³µ">âœˆï¸ ì œì£¼í•­ê³µ</option>
          </select>
        </div>
        <div class="form-group">
          <label for="scheduleConfirmation">í™•ì¸/ì˜ˆì•½ë²ˆí˜¸</label>
          <input type="text" id="scheduleConfirmation" placeholder="í•­ê³µí¸, í˜¸í…” ì˜ˆì•½ë²ˆí˜¸ ë“±">
        </div>
        <div class="form-group">
          <label for="scheduleNotes">ë¹„ê³ </label>
          <textarea id="scheduleNotes" placeholder="ì¶”ê°€ ë©”ëª¨ë‚˜ íŠ¹ì´ì‚¬í•­"></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="secondary" onclick="closeModal()">ì·¨ì†Œ</button>
          <button type="submit" class="success">ì €ì¥</button>
        </div>
      </form>
    </div>
  </div>

  <!-- QR ì½”ë“œ ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

  <script>
    // ì¼ì • ë°ì´í„° ì €ì¥ì†Œ
    let schedules = [];
    let editingIndex = -1;
    let shareId = null;

    // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
    document.addEventListener('DOMContentLoaded', function() {
      initializeApp();
    });

    // ì•± ì´ˆê¸°í™”
    function initializeApp() {
      // URLì—ì„œ ê³µìœ  ID í™•ì¸
      const urlParams = new URLSearchParams(window.location.search);
      const id = urlParams.get('id');
      
      if (id) {
        shareId = id;
        loadSharedSchedule(id);
      } else {
        loadSchedules();
      }
      
      renderSchedules();
      updateStats();
    }

    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì¼ì • ë¡œë“œ
    function loadSchedules() {
      const saved = localStorage.getItem('nhatrangSchedules');
      if (saved) {
        schedules = JSON.parse(saved);
      } else {
        // ê¸°ë³¸ ì¼ì • ë°ì´í„°
        schedules = [
          {
            id: 1,
            date: '2025-10-10',
            time: '14:00',
            activity: 'ì¸ì²œ/ê¹€í¬ â†’ ë‚˜íŠ¸ë‘(ë„ì°©) / ì²´í¬ì¸',
            location: 'ê³µí•­, í˜¸í…”',
            transport: 'ì œì£¼í•­ê³µ / ê³µí•­ë²„ìŠ¤/íƒì‹œ',
            confirmation: '',
            notes: 'ì¶œë°œ - í•­ê³µí¸ ì‹œê°„ ì…ë ¥'
          },
          {
            id: 2,
            date: '2025-10-11',
            time: '09:00',
            activity: 'ì‹œë‚´ê´€ê´‘ / í•´ë³€ / ì•¡í‹°ë¹„í‹°',
            location: 'ë‚˜íŠ¸ë‘ ë¹„ì¹˜, í¬ë‚˜ê°€ë¥´ íƒ‘ ë“±',
            transport: 'ë„ë³´/íƒì‹œ/íˆ¬ì–´ë²„ìŠ¤',
            confirmation: '',
            notes: ''
          },
          {
            id: 3,
            date: '2025-10-12',
            time: '08:00',
            activity: 'ìŠ¤ë…¸í´ë§/ë‹¤ì´ë¹™/í˜¸í•‘íˆ¬ì–´',
            location: 'ì¸ê·¼ ì„¬/ë¦¬ì¡°íŠ¸',
            transport: 'ë³´íŠ¸',
            confirmation: '',
            notes: ''
          },
          {
            id: 4,
            date: '2025-10-13',
            time: '10:00',
            activity: 'ë¬¸í™”/ì‹œì¥ ë°©ë¬¸, ì¹´í˜',
            location: 'ë‹´ì‹œì¥ ë“±',
            transport: 'íƒì‹œ/ë„ë³´',
            confirmation: '',
            notes: ''
          },
          {
            id: 5,
            date: '2025-10-14',
            time: '11:00',
            activity: 'ë¦¬ì¡°íŠ¸ íœ´ì‹ / ìŠ¤íŒŒ',
            location: 'ë¦¬ì¡°íŠ¸',
            transport: 'ë¦¬ì¡°íŠ¸ ì…”í‹€/ë„ë³´',
            confirmation: '',
            notes: ''
          },
          {
            id: 6,
            date: '2025-10-15',
            time: '16:00',
            activity: 'ì²´í¬ì•„ì›ƒ â†’ ê³µí•­ ì´ë™ â†’ ê·€êµ­',
            location: 'í˜¸í…”, ê³µí•­',
            transport: 'íƒì‹œ/ê³µí•­ë²„ìŠ¤ / ì œì£¼í•­ê³µ',
            confirmation: '',
            notes: 'ì¶œë°œ - í•­ê³µí¸ ì‹œê°„ ì…ë ¥'
          }
        ];
        saveSchedules();
      }
    }

    // ê³µìœ ëœ ìŠ¤ì¼€ì¤„ ë¡œë“œ
    function loadSharedSchedule(id) {
      const sharedData = localStorage.getItem(`shared_schedule_${id}`);
      if (sharedData) {
        schedules = JSON.parse(sharedData);
      } else {
        // ê³µìœ ëœ ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ ë°ì´í„° ë¡œë“œ
        loadSchedules();
      }
    }

    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì¼ì • ì €ì¥
    function saveSchedules() {
      localStorage.setItem('nhatrangSchedules', JSON.stringify(schedules));
      
      // ê³µìœ  IDê°€ ìˆìœ¼ë©´ ê³µìœ  ë°ì´í„°ë„ ì—…ë°ì´íŠ¸
      if (shareId) {
        localStorage.setItem(`shared_schedule_${shareId}`, JSON.stringify(schedules));
      }
    }

    // ì¼ì • ëª©ë¡ ë Œë”ë§
    function renderSchedules() {
      const scheduleList = document.getElementById('scheduleList');
      
      if (schedules.length === 0) {
        scheduleList.innerHTML = `
          <div class="empty-state">
            <h3>ì•„ì§ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤</h3>
            <p>â• ë²„íŠ¼ì„ ëˆŒëŸ¬ ì²« ë²ˆì§¸ ì¼ì •ì„ ì¶”ê°€í•´ë³´ì„¸ìš”!</p>
          </div>
        `;
        return;
      }

      // ë‚ ì§œìˆœìœ¼ë¡œ ì •ë ¬
      const sortedSchedules = [...schedules].sort((a, b) => new Date(a.date) - new Date(b.date));

      scheduleList.innerHTML = sortedSchedules.map((schedule, index) => {
        const date = new Date(schedule.date);
        const dayNames = ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];
        const dayName = dayNames[date.getDay()];
        
        return `
          <div class="schedule-card" data-id="${schedule.id}">
            <div class="schedule-header">
              <div class="date-info">
                <div class="date">${schedule.date}</div>
                <div class="day">${dayName}</div>
              </div>
              <div class="time">${schedule.time || 'ì‹œê°„ ë¯¸ì •'}</div>
            </div>
            <div class="schedule-content">
              <div class="activity">${schedule.activity}</div>
              ${schedule.location ? `<div class="location">${schedule.location}</div>` : ''}
              ${schedule.transport ? `<div class="transport">${schedule.transport}</div>` : ''}
              ${schedule.confirmation ? `<div class="confirmation">${schedule.confirmation}</div>` : ''}
              ${schedule.notes ? `<div class="notes">${schedule.notes}</div>` : ''}
              <div class="card-actions">
                <button class="success" onclick="editSchedule(${schedule.id})">âœï¸ í¸ì§‘</button>
                <button class="danger" onclick="deleteSchedule(${schedule.id})">ğŸ—‘ï¸ ì‚­ì œ</button>
              </div>
            </div>
          </div>
        `;
      }).join('');
    }

    // í†µê³„ ì—…ë°ì´íŠ¸
    function updateStats() {
      document.getElementById('totalActivities').textContent = schedules.length;
      document.getElementById('completedActivities').textContent = schedules.filter(s => s.confirmation).length;
    }

    // ëª¨ë‹¬ ì—´ê¸°
    function openAddModal() {
      editingIndex = -1;
      document.getElementById('modalTitle').textContent = 'ìƒˆ ì¼ì • ì¶”ê°€';
      document.getElementById('scheduleForm').reset();
      document.getElementById('scheduleModal').style.display = 'block';
      document.body.style.overflow = 'hidden';
    }

    // ì¼ì • í¸ì§‘ ëª¨ë‹¬ ì—´ê¸°
    function editSchedule(id) {
      const schedule = schedules.find(s => s.id === id);
      if (!schedule) return;

      editingIndex = schedules.indexOf(schedule);
      document.getElementById('modalTitle').textContent = 'ì¼ì • í¸ì§‘';
      
      // í¼ì— ë°ì´í„° ì±„ìš°ê¸°
      document.getElementById('scheduleDate').value = schedule.date;
      document.getElementById('scheduleTime').value = schedule.time || '';
      document.getElementById('scheduleActivity').value = schedule.activity;
      document.getElementById('scheduleLocation').value = schedule.location || '';
      document.getElementById('scheduleTransport').value = schedule.transport || '';
      document.getElementById('scheduleConfirmation').value = schedule.confirmation || '';
      document.getElementById('scheduleNotes').value = schedule.notes || '';
      
      document.getElementById('scheduleModal').style.display = 'block';
      document.body.style.overflow = 'hidden';
    }

    // ëª¨ë‹¬ ë‹«ê¸°
    function closeModal() {
      document.getElementById('scheduleModal').style.display = 'none';
      document.body.style.overflow = 'auto';
    }

    // ì¼ì • ì‚­ì œ
    function deleteSchedule(id) {
      if (confirm('ì´ ì¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        schedules = schedules.filter(s => s.id !== id);
        saveSchedules();
        renderSchedules();
        updateStats();
      }
    }

    // í¼ ì œì¶œ ì²˜ë¦¬
    document.getElementById('scheduleForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = {
        id: editingIndex === -1 ? Date.now() : schedules[editingIndex].id,
        date: document.getElementById('scheduleDate').value,
        time: document.getElementById('scheduleTime').value,
        activity: document.getElementById('scheduleActivity').value,
        location: document.getElementById('scheduleLocation').value,
        transport: document.getElementById('scheduleTransport').value,
        confirmation: document.getElementById('scheduleConfirmation').value,
        notes: document.getElementById('scheduleNotes').value
      };

      if (editingIndex === -1) {
        schedules.push(formData);
      } else {
        schedules[editingIndex] = formData;
      }

      saveSchedules();
      renderSchedules();
      updateStats();
      closeModal();
    });

    // CSV ë‹¤ìš´ë¡œë“œ
    function downloadCSV() {
      const headers = ['ë‚ ì§œ', 'ìš”ì¼', 'ì‹œê°„', 'í™œë™', 'ì¥ì†Œ', 'ì´ë™ìˆ˜ë‹¨', 'í™•ì¸', 'ë¹„ê³ '];
      const rows = [headers.join(',')];

      const sortedSchedules = [...schedules].sort((a, b) => new Date(a.date) - new Date(b.date));
      
      sortedSchedules.forEach(schedule => {
        const date = new Date(schedule.date);
        const dayNames = ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];
        const dayName = dayNames[date.getDay()];
        
        const row = [
          schedule.date,
          dayName,
          schedule.time || '',
          `"${schedule.activity}"`,
          `"${schedule.location || ''}"`,
          `"${schedule.transport || ''}"`,
          `"${schedule.confirmation || ''}"`,
          `"${schedule.notes || ''}"`
        ];
        rows.push(row.join(','));
      });

      const csv = rows.join('\n');
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `ë‚˜íŠ¸ë‘_ì—¬í–‰_ìŠ¤ì¼€ì¤„_${new Date().toISOString().split('T')[0]}.csv`;
      link.click();
      URL.revokeObjectURL(url);
    }

    // ê³µìœ  ê¸°ëŠ¥
    function shareSchedule() {
      if (!shareId) {
        // ìƒˆ ê³µìœ  ID ìƒì„±
        shareId = 'share_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        
        // ê³µìœ  ë°ì´í„° ì €ì¥
        localStorage.setItem(`shared_schedule_${shareId}`, JSON.stringify(schedules));
        
        // URL ì—…ë°ì´íŠ¸
        const newUrl = `${window.location.origin}${window.location.pathname}?id=${shareId}`;
        window.history.replaceState({}, '', newUrl);
      }
      
      const shareUrl = `${window.location.origin}${window.location.pathname}?id=${shareId}`;
      document.getElementById('shareLink').textContent = shareUrl;
      document.getElementById('shareSection').style.display = 'block';
      
      // QR ì½”ë“œ ìƒì„±
      generateQRCode(shareUrl);
    }

    // QR ì½”ë“œ ìƒì„±
    function generateQRCode(url) {
      const qrContainer = document.getElementById('qrcode');
      qrContainer.innerHTML = '';
      
      QRCode.toCanvas(qrContainer, url, {
        width: 200,
        height: 200,
        color: {
          dark: '#7b1f3a',
          light: '#ffffff'
        }
      }, function (error) {
        if (error) {
          console.error('QR ì½”ë“œ ìƒì„± ì‹¤íŒ¨:', error);
          qrContainer.innerHTML = '<p>QR ì½”ë“œ ìƒì„± ì‹¤íŒ¨</p>';
        }
      });
    }

    // ê³µìœ  ë§í¬ ë³µì‚¬
    async function copyShareLink() {
      const shareUrl = document.getElementById('shareLink').textContent;
      
      try {
        if (navigator.clipboard) {
          await navigator.clipboard.writeText(shareUrl);
          showNotification('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“‹');
        } else {
          // êµ¬í˜• ë¸Œë¼ìš°ì € ì§€ì›
          const textArea = document.createElement('textarea');
          textArea.value = shareUrl;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          showNotification('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ“‹');
        }
      } catch (error) {
        console.error('ë³µì‚¬ ì‹¤íŒ¨:', error);
        showNotification('ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë§í¬ë¥¼ ì§ì ‘ ë³µì‚¬í•´ì£¼ì„¸ìš”.', 'error');
      }
    }

    // ê³µìœ  ì„¹ì…˜ ë‹«ê¸°
    function closeShareSection() {
      document.getElementById('shareSection').style.display = 'none';
    }

    // ì•Œë¦¼ í‘œì‹œ
    function showNotification(message, type = 'success') {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: ${type === 'error' ? '#dc3545' : '#28a745'};
        color: white;
        padding: 12px 20px;
        border-radius: 25px;
        font-size: 14px;
        font-weight: 600;
        z-index: 10000;
        box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        animation: slideIn 0.3s ease;
      `;
      notification.textContent = message;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        notification.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => {
          document.body.removeChild(notification);
        }, 300);
      }, 3000);
    }

    // CSS ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
      }
      @keyframes slideOut {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
      }
    `;
    document.head.appendChild(style);

    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
    document.getElementById('scheduleModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeModal();
      }
    });

    // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closeModal();
      }
    });

    // í„°ì¹˜ ì œìŠ¤ì²˜ ì§€ì› (ëª¨ë°”ì¼)
    let startX = 0;
    let startY = 0;

    document.addEventListener('touchstart', function(e) {
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
    });

    document.addEventListener('touchend', function(e) {
      if (!startX || !startY) return;

      const endX = e.changedTouches[0].clientX;
      const endY = e.changedTouches[0].clientY;
      const diffX = startX - endX;
      const diffY = startY - endY;

      // ì¢Œìš° ìŠ¤ì™€ì´í”„ ê°ì§€
      if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
        if (diffX > 0) {
          // ì™¼ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„ - ë‹¤ìŒ ì¼ì •ìœ¼ë¡œ
          console.log('ì™¼ìª½ ìŠ¤ì™€ì´í”„');
        } else {
          // ì˜¤ë¥¸ìª½ìœ¼ë¡œ ìŠ¤ì™€ì´í”„ - ì´ì „ ì¼ì •ìœ¼ë¡œ
          console.log('ì˜¤ë¥¸ìª½ ìŠ¤ì™€ì´í”„');
        }
      }

      startX = 0;
      startY = 0;
    });
  </script>
</body>
</html>
